# 云驿 API 配置
# 复制此文件为 .env.local 并填入您的激活码

# ═══════════════════════════════════════════════════════
# 必填配置
# ═══════════════════════════════════════════════════════

# API Key (云驿激活码)
YUNYI_API_KEY=your-activation-code-here

# ═══════════════════════════════════════════════════════
# 可选配置 (一般不需要修改)
# ═══════════════════════════════════════════════════════

# 云驿 Codex 服务地址
YUNYI_CODEX_URL=https://yunyi.cfd/codex

# 云驿 Claude 服务地址 (如果有 Claude 权限)
YUNYI_CLAUDE_URL=https://yunyi.cfd/claude

# 代理服务端口 (默认 3456)
PROXY_PORT=3456

# 代理监听地址 (默认 127.0.0.1)
PROXY_HOST=127.0.0.1

# 可选：代理访问密钥 (启用后需在客户端 Authorization: Bearer <key>)
# PROXY_API_KEY=your-proxy-key

# 默认模型 (建议: gpt-5.2-codex)
YUNYI_MODEL=gpt-5.2-codex

# ═══════════════════════════════════════════════════════
# 安全与稳定性 (可选)
# ═══════════════════════════════════════════════════════

# 请求体大小限制 (默认 1048576)
# MAX_BODY_BYTES=1048576

# 读取请求超时 (毫秒，默认 15000)
# READ_TIMEOUT_MS=15000

# 上游请求超时 (毫秒，默认 45000)
# UPSTREAM_TIMEOUT_MS=45000

# CORS 允许来源（逗号分隔，默认 *）
# CORS_ORIGINS=*

# 强制关闭超时 (毫秒，默认 10000)
# FORCE_SHUTDOWN_MS=10000

# 是否打印请求内容预览 (默认 false)
# LOG_PREVIEW=false

# 是否自动释放占用端口 (默认 false，避免误杀)
# AUTO_KILL_PORT=false

# ═══════════════════════════════════════════════════════
# OpenAI SDK 兼容配置
# 启动代理后，SDK 可以使用这些配置
# ═══════════════════════════════════════════════════════

# OPENAI_API_KEY=your-activation-code-here
# OPENAI_BASE_URL=http://localhost:3456/v1

# ═══════════════════════════════════════════════════════
# Claude CLI → Codex 代理配置
# ═══════════════════════════════════════════════════════

# 代理模式:
#   codex  : Claude CLI → 云驿 Codex (默认，需上游 /codex/v1/responses 可用)
#   claude : Claude CLI → Claude 上游直通（不做协议转换）
CLAUDE_PROXY_MODE=codex

# Codex 上游服务地址
CODEX_UPSTREAM_URL=https://yunyi.cfd/codex

# Codex 模型 (gpt-5.2 或 gpt-5.2-codex)
CODEX_MODEL=gpt-5.2-codex

# 推理等级 (low/medium/high/xhigh)
# medium: 日常使用  xhigh: 复杂任务
CODEX_REASONING=medium

# Codex instructions 文件（⚠️ 必须是 Codex CLI 的标准 prompt，否则上游会拒绝）
# 默认: proxy/codex-prompt.md
# CODEX_INSTRUCTIONS_FILE=proxy/codex-prompt.md

# Claude 代理端口 (默认 3457)
CLAUDE_PROXY_PORT=3457

# Claude Code 兼容模式（默认开启，遇到 UI 工具缺失会自动降级不中止）
# CLAUDE_CODE_COMPAT=1

# 调试：打印 Claude 请求 content block 类型摘要（排查“对话不连续/上下文丢失”）
# CLAUDE_PROXY_DEBUG=0

# Claude Code UI 泄漏/降噪（可选）
# 工具消息写回上游时是否携带 JSON：full | truncate | none
# CLAUDE_PROXY_TOOL_PAYLOAD=truncate
# CLAUDE_PROXY_TOOL_PAYLOAD_MAX_CHARS=800

# 稳定性（可选）：重试与（可选）并发上限，降低 429 导致的 stream 中断
# 0 表示不限制并发
# CLAUDE_PROXY_MAX_CONCURRENCY=0
# CLAUDE_PROXY_RETRY_429=1
# CLAUDE_PROXY_MAX_RETRIES=3

# ───────────────────────────────────────────────────────
# 直通 Claude 上游 (仅在 CLAUDE_PROXY_MODE=claude 时需要)
# ───────────────────────────────────────────────────────

# Claude 上游服务地址
# CLAUDE_UPSTREAM_URL=https://code.newcli.com/claude/aws

# Claude 认证 Token
# CLAUDE_AUTH_TOKEN=your-anthropic-auth-token
